<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress VRT with Playwright</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"], input[type="url"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="url"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            cursor: pointer;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .button.secondary {
            background: #6c757d;
        }
        
        .button.success {
            background: #28a745;
        }
        
        .button.warning {
            background: #ffc107;
            color: #333;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .result {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .screenshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .screenshot-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .screenshot-item img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .screenshot-item h4 {
            margin: 10px 0 5px;
            color: #333;
        }
        
        .screenshot-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .diff-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .diff-info h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .diff-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .diff-stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        .diff-stat .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .diff-stat .label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .api-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .api-info h3 {
            margin-bottom: 15px;
            color: #1976d2;
        }
        
        .api-endpoint {
            background: #263238;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ WordPress VRT with Playwright</h1>
            <p>é«˜ç²¾åº¦ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã®è¦‹ãŸç›®å·®åˆ†æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="card">
            <h2>ğŸŒ è¤‡æ•°ã‚µã‚¤ãƒˆVRTãƒã‚§ãƒƒã‚¯</h2>
            <form id="vrtForm">
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label for="siteSelection">ğŸŒ å¯¾è±¡ã‚µã‚¤ãƒˆ</label>
                            <select id="siteSelection" name="siteSelection" multiple style="height: 150px;">
                                <option value="all" selected>å…¨ã‚µã‚¤ãƒˆ</option>
                            </select>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                Ctrl/Cmdã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰è¤‡æ•°é¸æŠå¯èƒ½
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="executionMode">ğŸš€ å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰</label>
                            <select id="executionMode" name="executionMode">
                                <option value="step1-only">Step1: æ›´æ–°å‰æ’®å½±ã®ã¿</option>
                                <option value="step2-and-3" selected>Step2+3: æ’®å½±â†’å³åº§ã«æ¯”è¼ƒ</option>
                                <option value="step3-only">Step3: æ¯”è¼ƒã®ã¿</option>
                                <option value="full-workflow">ãƒ•ãƒ«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</option>
                                <option value="crawl-only">ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã¿ï¼ˆURLåé›†ï¼‰</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="crawlMode">ğŸ•·ï¸ ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š</label>
                            <select id="crawlMode" name="crawlMode">
                                <option value="auto">è‡ªå‹•ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå…¨ãƒšãƒ¼ã‚¸åé›†ï¼‰</option>
                                <option value="single">å˜ä¸€ãƒšãƒ¼ã‚¸ï¼ˆãƒˆãƒƒãƒ—ã®ã¿ï¼‰</option>
                                <option value="manual">æ‰‹å‹•URLæŒ‡å®š</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <div class="form-group">
                            <label>ğŸ“± å¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="devices" value="desktop" checked>
                                    ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—
                                </label>
                                <label>
                                    <input type="checkbox" name="devices" value="mobile">
                                    ãƒ¢ãƒã‚¤ãƒ«
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="threshold">ğŸ¯ å·®åˆ†é—¾å€¤ (%)</label>
                            <input type="number" id="threshold" name="threshold" value="2.0" step="0.1" min="0.1" max="10.0" style="width: 100px;">
                            <small style="color: #666; display: block; margin-top: 5px;">
                                å¤‰åŒ–ç‡ãŒã“ã®å€¤ã‚’è¶…ãˆã‚‹ã¨NGåˆ¤å®š
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxPages">ğŸ“„ æœ€å¤§ãƒšãƒ¼ã‚¸æ•°</label>
                            <input type="number" id="maxPages" name="maxPages" value="30" min="1" max="100" style="width: 100px;">
                            <small style="color: #666; display: block; margin-top: 5px;">
                                ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ä¸Šé™ãƒšãƒ¼ã‚¸æ•°
                            </small>
                        </div>
                    </div>
                </div>
                
                <div id="manualUrlSection" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="manualUrls">ğŸ”— æ‰‹å‹•URLæŒ‡å®šï¼ˆä¸€è¡Œä¸€URLï¼‰</label>
                        <textarea id="manualUrls" name="manualUrls" rows="5" style="width: 100%; font-family: monospace;" placeholder="https://example.com/\nhttps://example.com/about\nhttps://example.com/contact"></textarea>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button type="submit" class="button" id="executeButton">ğŸ¯ å®Ÿè¡Œ</button>
                    <button type="button" class="button secondary" onclick="showSiteManager()">ğŸŒ ã‚µã‚¤ãƒˆç®¡ç†</button>
                    <button type="button" class="button secondary" onclick="showResults()">ğŸ“ˆ çµæœç¢ºèª</button>
                    <button type="button" class="button warning" onclick="refreshSites()">ğŸ”„ ã‚µã‚¤ãƒˆä¸€è¦§æ›´æ–°</button>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                    <h4 style="margin-bottom: 10px;">ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</h4>
                    <p style="margin-bottom: 10px; color: #666; font-size: 0.9em;">
                        config.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®ã™ã‚‹ã¨è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
                    </p>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="file" id="configFileInput" accept=".json" style="flex: 1;">
                        <button type="button" class="button secondary" onclick="loadConfigFile()">ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</button>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e1e5e9;">
                    <h3 style="margin-bottom: 15px; color: #555;">ğŸ”„ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ—§æ©Ÿèƒ½ï¼‰</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button type="button" class="button secondary" onclick="takeBeforeUpdate()">
                            ğŸ“¸ Step 1: æ›´æ–°å‰ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆæ—§ï¼‰
                        </button>
                        <div style="display: flex; align-items: center; padding: 10px 15px; background: #f8f9fa; border-radius: 6px; font-weight: 500;">
                            â†“ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°å®Ÿè¡Œ â†“
                        </div>
                        <button type="button" class="button secondary" onclick="takeAfterUpdate()">
                            ğŸ“¸ Step 2: æ›´æ–°å¾Œã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆæ—§ï¼‰
                        </button>
                        <button type="button" class="button secondary" onclick="compareUpdates()">
                            ğŸ” Step 3: å·®åˆ†ãƒã‚§ãƒƒã‚¯ï¼ˆæ—§ï¼‰
                        </button>
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        â€» ä¸Šè¨˜ã¯å¾“æ¥æ©Ÿèƒ½ã§ã™ã€‚æ–°ã—ã„è¤‡æ•°ã‚µã‚¤ãƒˆå¯¾å¿œæ©Ÿèƒ½ã‚’ä¸Šã§ã”åˆ©ç”¨ãã ã•ã„ã€‚
                    </p>
                </div>
            </form>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>VRTãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...</p>
        </div>

        <div id="results"></div>

        <!-- ã‚µã‚¤ãƒˆç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="siteManagerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="card" style="position: relative; max-width: 600px; margin: 50px auto; max-height: 80vh; overflow-y: auto;">
                <h3>ğŸŒ ã‚µã‚¤ãƒˆç®¡ç†</h3>
                <div id="sitesList" style="margin: 20px 0;"></div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e1e5e9;">
                    <h4>æ–°è¦ã‚µã‚¤ãƒˆè¿½åŠ </h4>
                    <div class="grid">
                        <input type="text" id="newSiteId" placeholder="ã‚µã‚¤ãƒˆID" style="margin-bottom: 10px;">
                        <input type="text" id="newSiteName" placeholder="ã‚µã‚¤ãƒˆå" style="margin-bottom: 10px;">
                    </div>
                    <input type="url" id="newSiteUrl" placeholder="https://example.com" style="width: 100%; margin-bottom: 10px;">
                    <button class="button success" onclick="addNewSite()">ğŸ† ã‚µã‚¤ãƒˆè¿½åŠ </button>
                </div>
                <button class="button secondary" onclick="closeSiteManager()" style="margin-top: 20px;">é–‰ã˜ã‚‹</button>
            </div>
        </div>
        
        <div class="api-info">
            <h3>ğŸ“š API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</h3>
            <div class="api-endpoint">POST /capture-baseline - Step1 Baselineæ’®å½±</div>
            <div class="api-endpoint">POST /capture-and-compare - Step2+3çµ±åˆå®Ÿè¡Œ</div>
            <div class="api-endpoint">POST /crawl - ã‚µã‚¤ãƒˆã‚¯ãƒ­ãƒ¼ãƒ«</div>
            <div class="api-endpoint">GET /results - å®Ÿè¡Œçµæœä¸€è¦§</div>
            <div class="api-endpoint">GET /sites - ã‚µã‚¤ãƒˆä¸€è¦§</div>
        </div>
    </div>

    <script>
        const form = document.getElementById('vrtForm');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        let allSites = [];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            await loadSites();
            setupEventListeners();
        });

        function setupEventListeners() {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await executeVRT();
            });

            // ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã®UIæ›´æ–°
            document.getElementById('crawlMode').addEventListener('change', (e) => {
                const manualSection = document.getElementById('manualUrlSection');
                manualSection.style.display = e.target.value === 'manual' ? 'block' : 'none';
            });

            // å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã®ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
            document.getElementById('executionMode').addEventListener('change', (e) => {
                updateExecuteButtonText();
            });
        }

        function updateExecuteButtonText() {
            const mode = document.getElementById('executionMode').value;
            const button = document.getElementById('executeButton');
            const modeTexts = {
                'step1-only': 'ğŸ“¸ Step1å®Ÿè¡Œ',
                'step2-and-3': 'ğŸš€ Step2+3å®Ÿè¡Œ',
                'step3-only': 'ğŸ” Step3å®Ÿè¡Œ',
                'full-workflow': 'ğŸ† ãƒ•ãƒ«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ',
                'crawl-only': 'ğŸ•·ï¸ ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè¡Œ'
            };
            button.textContent = modeTexts[mode] || 'ğŸ¯ å®Ÿè¡Œ';
        }

        async function loadSites() {
            try {
                const response = await fetch('/sites');
                const data = await response.json();
                
                if (data.success) {
                    allSites = data.sites;
                    updateSiteSelection();
                } else {
                    console.error('ã‚µã‚¤ãƒˆä¸€è¦§ã®å–å¾—ã«å¤±æ•—:', data.error);
                }
            } catch (error) {
                console.error('ã‚µã‚¤ãƒˆä¸€è¦§ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        function updateSiteSelection() {
            const select = document.getElementById('siteSelection');
            const enabledSites = allSites.filter(site => site.enabled);
            
            select.innerHTML = `
                <option value="all">å…¨ã‚µã‚¤ãƒˆ (${enabledSites.length})</option>
                ${enabledSites.map(site => 
                    `<option value="${site.id}">${site.name} (${site.baseUrl})</option>`
                ).join('')}
            `;
        }

        async function executeVRT() {
            const formData = new FormData(form);
            const siteSelection = Array.from(document.getElementById('siteSelection').selectedOptions).map(opt => opt.value);
            const executionMode = formData.get('executionMode');
            const crawlMode = formData.get('crawlMode');
            const devices = formData.getAll('devices');
            const threshold = parseFloat(formData.get('threshold'));
            const maxPages = parseInt(formData.get('maxPages'));
            const manualUrls = formData.get('manualUrls');

            if (devices.length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (siteSelection.length === 0) {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®ã‚µã‚¤ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            showLoading(true);
            clearResults();

            try {
                if (executionMode === 'crawl-only') {
                    await executeCrawlOnly(siteSelection, maxPages);
                } else if (executionMode === 'step1-only') {
                    await executeStep1Only(siteSelection, devices, crawlMode, maxPages, manualUrls);
                } else if (executionMode === 'step2-and-3') {
                    await executeStep2And3(siteSelection, devices, threshold, crawlMode, maxPages, manualUrls);
                } else if (executionMode === 'step3-only') {
                    await executeStep3Only(siteSelection, devices, threshold);
                } else if (executionMode === 'full-workflow') {
                    await executeFullWorkflow(siteSelection, devices, threshold, crawlMode, maxPages, manualUrls);
                }
            } catch (error) {
                displayError(error.message);
            } finally {
                showLoading(false);
            }
        }

        async function executeCrawlOnly(siteSelection, maxPages) {
            const targetSites = siteSelection.includes('all') ? 
                allSites.filter(s => s.enabled) : 
                allSites.filter(s => siteSelection.includes(s.id) && s.enabled);

            const results = [];
            for (const site of targetSites) {
                console.log(`ğŸ•·ï¸ ${site.id} ã‚’ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­...`);
                
                const response = await fetch('/crawl', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url: site.baseUrl, 
                        maxPages: maxPages 
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    results.push({
                        siteId: site.id,
                        siteName: site.name,
                        ...data.result
                    });
                }
            }
            
            displayCrawlResults(results);
        }

        async function executeStep2And3(siteSelection, devices, threshold, crawlMode, maxPages, manualUrls) {
            const requestBody = {
                threshold: threshold,
                crawlMode: crawlMode
            };

            if (siteSelection.includes('all')) {
                requestBody.siteIds = 'all';
            } else {
                requestBody.siteIds = siteSelection;
            }

            // æ‰‹å‹•URLæŒ‡å®šã®å ´åˆ
            if (crawlMode === 'manual' && manualUrls) {
                const urls = manualUrls.split('\n').filter(url => url.trim());
                requestBody.pages = urls.map((url, index) => ({
                    url: url.trim(),
                    pageId: String(index + 1).padStart(3, '0'),
                    identifier: `manual-${index + 1}`,
                    title: `Manual URL ${index + 1}`
                }));
            }

            const results = [];
            for (const device of devices) {
                const response = await fetch('/capture-and-compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...requestBody, device })
                });
                
                const data = await response.json();
                if (data.success) {
                    results.push({ device, ...data });
                }
            }
            
            displayStep2And3Results(results);
        }

        // Step1ã®ã¿å®Ÿè¡Œï¼ˆBaselineæ’®å½±ï¼‰
        async function executeStep1Only(siteSelection, devices, crawlMode, maxPages, manualUrls) {
            const requestBody = {
                crawlMode: crawlMode,
                maxPages: maxPages
            };

            if (siteSelection.includes('all')) {
                requestBody.siteIds = 'all';
            } else {
                requestBody.siteIds = siteSelection;
            }

            // æ‰‹å‹•URLæŒ‡å®šã®å ´åˆ
            if (crawlMode === 'manual' && manualUrls) {
                const urls = manualUrls.split('\n').filter(url => url.trim());
                requestBody.pages = urls.map((url, index) => ({
                    url: url.trim(),
                    pageId: String(index + 1).padStart(3, '0'),
                    identifier: `manual-${index + 1}`,
                    title: `Manual URL ${index + 1}`
                }));
            }

            const results = [];
            for (const device of devices) {
                const response = await fetch('/capture-baseline', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...requestBody, device })
                });
                
                const data = await response.json();
                if (data.success) {
                    results.push({ device, ...data });
                }
            }
            
            displayStep1Results(results);
        }

        async function executeStep3Only(siteSelection, devices, threshold) {
            displayInfo('âš™ï¸ Step3ã®ã¿ã®å®Ÿè¡Œã¯é–‹ç™ºä¸­ã§ã™ã€‚Step2+3ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
        }

        async function executeFullWorkflow(siteSelection, devices, threshold, crawlMode, maxPages, manualUrls) {
            // Step1ã¨Step2+3ã‚’é †æ¬¡å®Ÿè¡Œ
            await executeStep1Only(siteSelection, devices, crawlMode, maxPages, manualUrls);
            // å°‘ã—å¾…æ©Ÿ
            await new Promise(resolve => setTimeout(resolve, 2000));
            await executeStep2And3(siteSelection, devices, threshold, crawlMode, maxPages, manualUrls);
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }

        function clearResults() {
            const results = document.getElementById('results');
            results.innerHTML = '';
        }

        function displayFullVRTResults(data) {
            const hasNG = data.summary && data.summary.ng > 0;
            const resultClass = hasNG ? 'warning' : 'success';
            
            results.innerHTML = `
                <div class="card">
                    <div class="result ${resultClass}">
                        <h3>ğŸ‰ ãƒ•ãƒ«VRTãƒã‚§ãƒƒã‚¯å®Œäº†</h3>
                        <p><strong>ã‚µã‚¤ãƒˆ:</strong> ${data.siteId}</p>
                        <p><strong>URL:</strong> ${data.url}</p>
                        <p><strong>åˆ¤å®š:</strong> ${hasNG ? 'âš ï¸ NGï¼ˆå·®åˆ†æ¤œå‡ºï¼‰' : 'âœ… OK'}</p>
                    </div>
                    
                    ${data.summary ? `
                    <div class="diff-info">
                        <h4>ğŸ“Š å®Ÿè¡Œã‚µãƒãƒªãƒ¼</h4>
                        <div class="diff-stats">
                            <div class="diff-stat">
                                <div class="value">${data.summary.total}</div>
                                <div class="label">ç·ãƒ‡ãƒã‚¤ã‚¹æ•°</div>
                            </div>
                            <div class="diff-stat">
                                <div class="value">${data.summary.ok}</div>
                                <div class="label">OK</div>
                            </div>
                            <div class="diff-stat">
                                <div class="value">${data.summary.ng}</div>
                                <div class="label">NG</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${data.results ? data.results.map(result => `
                        <div class="diff-info">
                            <h4>ğŸ“± ${result.device} çµæœ</h4>
                            ${result.comparison ? `
                            <div class="diff-stats">
                                <div class="diff-stat">
                                    <div class="value">${result.comparison.status}</div>
                                    <div class="label">åˆ¤å®š</div>
                                </div>
                                <div class="diff-stat">
                                    <div class="value">${result.comparison.diffPercentage}%</div>
                                    <div class="label">å·®åˆ†ç‡</div>
                                </div>
                                <div class="diff-stat">
                                    <div class="value">${result.comparison.diffPixels}</div>
                                    <div class="label">å·®åˆ†ãƒ”ã‚¯ã‚»ãƒ«</div>
                                </div>
                            </div>
                            ${result.comparison.diffPath ? `
                            <p><strong>å·®åˆ†ç”»åƒ:</strong> <a href="${result.comparison.diffPath}" target="_blank">è¡¨ç¤º</a></p>
                            ` : ''}
                            ` : ''}
                        </div>
                    `).join('') : ''}
                </div>
            `;
        }

        function displayComparisonResults(results) {
            const hasNG = results.some(r => r.status === 'NG');
            const resultClass = hasNG ? 'warning' : 'success';
            
            results.innerHTML = `
                <div class="card">
                    <div class="result ${resultClass}">
                        <h3>ğŸ” ç”»åƒæ¯”è¼ƒå®Œäº†</h3>
                        <p><strong>åˆ¤å®š:</strong> ${hasNG ? 'âš ï¸ NGï¼ˆå·®åˆ†æ¤œå‡ºï¼‰' : 'âœ… OK'}</p>
                    </div>
                    
                    ${results.map(result => `
                        <div class="diff-info">
                            <h4>ğŸ“± ${result.device} æ¯”è¼ƒçµæœ</h4>
                            <div class="diff-stats">
                                <div class="diff-stat">
                                    <div class="value">${result.status}</div>
                                    <div class="label">åˆ¤å®š</div>
                                </div>
                                <div class="diff-stat">
                                    <div class="value">${result.diffPercentage}%</div>
                                    <div class="label">å·®åˆ†ç‡</div>
                                </div>
                                <div class="diff-stat">
                                    <div class="value">${result.diffPixels}</div>
                                    <div class="label">å·®åˆ†ãƒ”ã‚¯ã‚»ãƒ«</div>
                                </div>
                            </div>
                            ${result.diffPath ? `
                            <p><strong>å·®åˆ†ç”»åƒ:</strong> <a href="${result.diffPath}" target="_blank">è¡¨ç¤º</a></p>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayScreenshotResults(results, action) {
            results.innerHTML = `
                <div class="card">
                    <div class="result success">
                        <h3>ğŸ“¸ ${action} æ’®å½±å®Œäº†</h3>
                        <p>${results.length}å€‹ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã—ã¾ã—ãŸã€‚</p>
                    </div>
                    
                    <div class="screenshot-grid">
                        ${results.map(result => `
                            <div class="screenshot-item">
                                <h4>ğŸ“± ${result.device}</h4>
                                <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${result.filename}</p>
                                <p><strong>ã‚µã‚¤ã‚º:</strong> ${(result.size / 1024 / 1024).toFixed(2)} MB</p>
                                <p><strong>æ™‚åˆ»:</strong> ${new Date(result.timestamp).toLocaleString()}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function displayError(error) {
            results.innerHTML = `
                <div class="card">
                    <div class="result error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                        <p>${error}</p>
                    </div>
                </div>
            `;
        }

        async function loadScreenshots() {
            const siteId = document.getElementById('siteId').value;
            if (!siteId) {
                alert('ã‚µã‚¤ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const response = await fetch(`/screenshots/${siteId}`);
                const data = await response.json();
                
                if (data.screenshots && data.screenshots.length > 0) {
                    results.innerHTML = `
                        <div class="card">
                            <h3>ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¸€è¦§ (${siteId})</h3>
                            <div class="screenshot-grid">
                                ${data.screenshots.map(screenshot => `
                                    <div class="screenshot-item">
                                        <img src="${screenshot.path}" alt="${screenshot.type} - ${screenshot.device}" 
                                             style="max-width: 200px; cursor: pointer;" 
                                             onclick="window.open('${screenshot.path}', '_blank')">
                                        <h4>${screenshot.type} - ${screenshot.device}</h4>
                                        <p>${new Date(screenshot.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="card">
                            <div class="result warning">
                                <h3>ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h3>
                                <p>ã‚µã‚¤ãƒˆIDã€Œ${siteId}ã€ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                displayError('ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        async function loadDiffs() {
            const siteId = document.getElementById('siteId').value;
            if (!siteId) {
                alert('ã‚µã‚¤ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const response = await fetch(`/diffs/${siteId}`);
                const data = await response.json();
                
                if (data.diffs && data.diffs.length > 0) {
                    results.innerHTML = `
                        <div class="card">
                            <h3>ğŸ” å·®åˆ†ç”»åƒä¸€è¦§ (${siteId})</h3>
                            <div class="screenshot-grid">
                                ${data.diffs.map(diff => `
                                    <div class="screenshot-item">
                                        <img src="${diff.path}" alt="å·®åˆ†ç”»åƒ - ${diff.device}" 
                                             style="max-width: 200px; cursor: pointer;" 
                                             onclick="window.open('${diff.path}', '_blank')">
                                        <h4>å·®åˆ† - ${diff.device}</h4>
                                        <p>${new Date(diff.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</p>
                                        <p>ã‚µã‚¤ã‚º: ${(diff.size / 1024).toFixed(1)} KB</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="card">
                            <div class="result warning">
                                <h3>ğŸ” å·®åˆ†ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h3>
                                <p>ã‚µã‚¤ãƒˆIDã€Œ${siteId}ã€ã®å·®åˆ†ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                displayError('å·®åˆ†ç”»åƒä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–¢æ•°
        async function takeBeforeUpdate() {
            const url = document.getElementById('url').value;
            const siteId = document.getElementById('siteId').value;
            const devices = Array.from(document.querySelectorAll('input[name="devices"]:checked')).map(cb => cb.value);
            
            if (!url || !siteId || devices.length === 0) {
                alert('URLã€ã‚µã‚¤ãƒˆIDã€ãƒ‡ãƒã‚¤ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            showLoading(true);
            clearResults();
            
            try {
                const results = [];
                for (const device of devices) {
                    const res = await fetch('/screenshot', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url, siteId, type: 'baseline', device })
                    });
                    const data = await res.json();
                    results.push({ device, ...data.result });
                }
                
                document.getElementById('results').innerHTML = `
                    <div class="card">
                        <div class="result success">
                            <h3>âœ… Step 1: æ›´æ–°å‰ã‚­ãƒ£ãƒ—ãƒãƒ£å®Œäº†</h3>
                            <p>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ã€ŒStep 2: æ›´æ–°å¾Œã‚­ãƒ£ãƒ—ãƒãƒ£ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                        <div class="screenshot-grid">
                            ${results.map(result => `
                                <div class="screenshot-item">
                                    <h4>ğŸ“± ${result.device}</h4>
                                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${result.filename}</p>
                                    <p><strong>æ™‚åˆ»:</strong> ${new Date(result.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                displayError('æ›´æ–°å‰ã‚­ãƒ£ãƒ—ãƒãƒ£ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function takeAfterUpdate() {
            const url = document.getElementById('url').value;
            const siteId = document.getElementById('siteId').value;
            const devices = Array.from(document.querySelectorAll('input[name="devices"]:checked')).map(cb => cb.value);
            
            if (!url || !siteId || devices.length === 0) {
                alert('URLã€ã‚µã‚¤ãƒˆIDã€ãƒ‡ãƒã‚¤ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            showLoading(true);
            clearResults();
            
            try {
                const results = [];
                for (const device of devices) {
                    const res = await fetch('/screenshot', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url, siteId, type: 'after', device })
                    });
                    const data = await res.json();
                    results.push({ device, ...data.result });
                }
                
                document.getElementById('results').innerHTML = `
                    <div class="card">
                        <div class="result success">
                            <h3>âœ… Step 2: æ›´æ–°å¾Œã‚­ãƒ£ãƒ—ãƒãƒ£å®Œäº†</h3>
                            <p>ã€ŒStep 3: å·®åˆ†ãƒã‚§ãƒƒã‚¯ã€ã‚’å®Ÿè¡Œã—ã¦å¤‰æ›´ç‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                        <div class="screenshot-grid">
                            ${results.map(result => `
                                <div class="screenshot-item">
                                    <h4>ğŸ“± ${result.device}</h4>
                                    <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${result.filename}</p>
                                    <p><strong>æ™‚åˆ»:</strong> ${new Date(result.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                displayError('æ›´æ–°å¾Œã‚­ãƒ£ãƒ—ãƒãƒ£ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function compareUpdates() {
            const siteId = document.getElementById('siteId').value;
            const devices = Array.from(document.querySelectorAll('input[name="devices"]:checked')).map(cb => cb.value);
            
            if (!siteId || devices.length === 0) {
                alert('ã‚µã‚¤ãƒˆIDã¨ãƒ‡ãƒã‚¤ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            showLoading(true);
            clearResults();
            
            try {
                const results = [];
                for (const device of devices) {
                    const res = await fetch('/compare', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ siteId, device })
                    });
                    const data = await res.json();
                    results.push({ device, ...data.result });
                }
                
                const hasNG = results.some(r => r.status === 'NG');
                const resultClass = hasNG ? 'warning' : 'success';
                
                results.innerHTML = `
                    <div class="card">
                        <div class="result ${resultClass}">
                            <h3>${hasNG ? 'âš ï¸ Step 3: å·®åˆ†ã‚’æ¤œå‡ºã—ã¾ã—ãŸ' : 'âœ… Step 3: å·®åˆ†ãªã— - æ­£å¸¸'}</h3>
                            <p><strong>åˆ¤å®š:</strong> ${hasNG ? 'ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ã«ã‚ˆã‚Šè¦‹ãŸç›®ã®å¤‰åŒ–ãŒã‚ã‚Šã¾ã™' : 'ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ã«ã‚ˆã‚‹è¦‹ãŸç›®ã®å¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“'}</p>
                        </div>
                        
                        ${results.map(result => `
                            <div class="diff-info">
                                <h4>ğŸ“± ${result.device} æ¯”è¼ƒçµæœ</h4>
                                <div class="diff-stats">
                                    <div class="diff-stat">
                                        <div class="value" style="color: ${result.status === 'NG' ? '#dc3545' : '#28a745'}">${result.status}</div>
                                        <div class="label">åˆ¤å®š</div>
                                    </div>
                                    <div class="diff-stat">
                                        <div class="value">${result.diffPercentage}%</div>
                                        <div class="label">å·®åˆ†ç‡</div>
                                    </div>
                                    <div class="diff-stat">
                                        <div class="value">${result.diffPixels}</div>
                                        <div class="label">å·®åˆ†ãƒ”ã‚¯ã‚»ãƒ«</div>
                                    </div>
                                </div>
                                ${result.diffPath ? `
                                <p><strong>å·®åˆ†ç”»åƒ:</strong> <a href="${result.diffPath}" target="_blank" style="color: #667eea; text-decoration: none;">ğŸ“¸ å·®åˆ†ã‚’ç¢ºèª</a></p>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                displayError('å·®åˆ†ãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayCrawlResults(results) {
            const totalPages = results.reduce((sum, r) => sum + r.totalPages, 0);
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result success">
                        <h3>ğŸ•·ï¸ ã‚¯ãƒ­ãƒ¼ãƒ«å®Œäº†</h3>
                        <p><strong>å¯¾è±¡ã‚µã‚¤ãƒˆ:</strong> ${results.length}ã‚µã‚¤ãƒˆ</p>
                        <p><strong>ç·ãƒšãƒ¼ã‚¸æ•°:</strong> ${totalPages}ãƒšãƒ¼ã‚¸</p>
                    </div>
                    
                    ${results.map(result => `
                        <div class="diff-info">
                            <h4>ğŸŒ ${result.siteName} (${result.siteId})</h4>
                            <p><strong>ãƒ™ãƒ¼ã‚¹URL:</strong> ${result.baseUrl}</p>
                            <p><strong>åé›†ãƒšãƒ¼ã‚¸æ•°:</strong> ${result.totalPages}ãƒšãƒ¼ã‚¸</p>
                            <details>
                                <summary>ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚’è¡¨ç¤º</summary>
                                <ul style="margin-top: 10px; max-height: 200px; overflow-y: auto;">
                                    ${result.pages.map(page => 
                                        `<li><a href="${page.url}" target="_blank">${page.title}</a></li>`
                                    ).join('')}
                                </ul>
                            </details>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayStep1Results(results) {
            const allResults = results.flatMap(r => r.results || []);
            const totalSites = allResults.length;
            const totalPages = allResults.reduce((sum, r) => sum + r.captureCount, 0);
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result success">
                        <h3>âœ… Step1: Baselineæ’®å½±å®Œäº†</h3>
                        <p><strong>å®Ÿè¡Œã‚µã‚¤ãƒˆ:</strong> ${totalSites}ã‚µã‚¤ãƒˆ</p>
                        <p><strong>ç·ãƒšãƒ¼ã‚¸æ•°:</strong> ${totalPages}ãƒšãƒ¼ã‚¸</p>
                        <p style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px;">
                            ğŸ“ <strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong><br>
                            1. WordPressã®ç®¡ç†ç”»é¢ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ›´æ–°ã‚’å®Ÿè¡Œ<br>
                            2. ä¸Šè¨˜ãƒ•ã‚©ãƒ¼ãƒ ã§ã€ŒStep2+3: æ’®å½±â†’å³åº§ã«æ¯”è¼ƒã€ã‚’é¸æŠã—ã¦å®Ÿè¡Œ
                        </p>
                    </div>
                    
                    ${results.map(deviceResult => `
                        <div class="diff-info">
                            <h4>ğŸ“± ${deviceResult.device} çµæœ</h4>
                            ${deviceResult.results.map(siteResult => `
                                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                                    <h5>ğŸŒ ${siteResult.siteName}</h5>
                                    <p><strong>æ’®å½±ãƒšãƒ¼ã‚¸:</strong> ${siteResult.captureCount}ãƒšãƒ¼ã‚¸</p>
                                    <p><strong>ä¿å­˜å ´æ‰€:</strong> screenshots/${siteResult.siteId}/</p>
                                    <details>
                                        <summary>æ’®å½±ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚’è¡¨ç¤º</summary>
                                        <ul style="margin-top: 10px; max-height: 150px; overflow-y: auto; font-size: 0.9em;">
                                            ${siteResult.pages ? siteResult.pages.map(page => 
                                                `<li>${page.title || page.identifier}</li>`
                                            ).join('') : ''}
                                        </ul>
                                    </details>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayStep2And3Results(results) {
            const allResults = results.flatMap(r => r.results || []);
            const totalSites = allResults.length;
            const totalPages = allResults.reduce((sum, r) => sum + r.captureCount, 0);
            const ngSites = allResults.filter(r => 
                r.compareResults.summary ? r.compareResults.summary.ng > 0 : 
                r.compareResults.status === 'NG'
            ).length;
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result ${ngSites > 0 ? 'warning' : 'success'}">
                        <h3>${ngSites > 0 ? 'âš ï¸' : 'âœ…'} Step2+3çµ±åˆå®Ÿè¡Œå®Œäº†</h3>
                        <p><strong>å®Ÿè¡Œã‚µã‚¤ãƒˆ:</strong> ${totalSites}ã‚µã‚¤ãƒˆ</p>
                        <p><strong>ç·ãƒšãƒ¼ã‚¸æ•°:</strong> ${totalPages}ãƒšãƒ¼ã‚¸</p>
                        <p><strong>çµæœ:</strong> OK: ${totalSites - ngSites}ã‚µã‚¤ãƒˆ, NG: ${ngSites}ã‚µã‚¤ãƒˆ</p>
                    </div>
                    
                    ${results.map(deviceResult => `
                        <div class="diff-info">
                            <h4>ğŸ“± ${deviceResult.device} çµæœ</h4>
                            ${deviceResult.results.map(siteResult => `
                                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                                    <h5>ğŸŒ ${siteResult.siteName}</h5>
                                    <p><strong>æ’®å½±ãƒšãƒ¼ã‚¸:</strong> ${siteResult.captureCount}ãƒšãƒ¼ã‚¸</p>
                                    ${siteResult.compareResults.summary ? `
                                        <p><strong>æ¯”è¼ƒçµæœ:</strong> 
                                            OK: ${siteResult.compareResults.summary.ok}, 
                                            NG: ${siteResult.compareResults.summary.ng}
                                        </p>
                                    ` : `
                                        <p><strong>æ¯”è¼ƒçµæœ:</strong> ${siteResult.compareResults.status}</p>
                                    `}
                                    <p><strong>é—¾å€¤:</strong> ${siteResult.threshold}%</p>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayInfo(message) {
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result warning">
                        <h3>ğŸ“ æƒ…å ±</h3>
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }

        // ã‚µã‚¤ãƒˆç®¡ç†é–¢é€£é–¢æ•°
        function showSiteManager() {
            loadSitesList();
            document.getElementById('siteManagerModal').style.display = 'block';
        }

        function closeSiteManager() {
            document.getElementById('siteManagerModal').style.display = 'none';
        }

        async function loadSitesList() {
            const sitesListDiv = document.getElementById('sitesList');
            sitesListDiv.innerHTML = `
                ${allSites.map(site => `
                    <div style="padding: 10px; margin: 5px 0; background: ${site.enabled ? '#e8f5e8' : '#f5f5f5'}; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${site.name}</strong> (${site.id})<br>
                            <small>${site.baseUrl} - æœ€å¤§${site.maxPages}ãƒšãƒ¼ã‚¸</small>
                        </div>
                        <div>
                            <button class="button ${site.enabled ? 'warning' : 'success'}" onclick="toggleSite('${site.id}')">
                                ${site.enabled ? 'ç„¡åŠ¹åŒ–' : 'æœ‰åŠ¹åŒ–'}
                            </button>
                            <button class="button secondary" onclick="deleteSite('${site.id}')">å‰Šé™¤</button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        async function addNewSite() {
            const siteId = document.getElementById('newSiteId').value;
            const siteName = document.getElementById('newSiteName').value;
            const siteUrl = document.getElementById('newSiteUrl').value;

            if (!siteId || !siteUrl) {
                alert('ã‚µã‚¤ãƒˆIDã¨URLã¯å¿…é ˆã§ã™ã€‚');
                return;
            }

            try {
                const response = await fetch('/sites', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        siteId: siteId,
                        name: siteName || siteId,
                        baseUrl: siteUrl
                    })
                });

                const data = await response.json();
                if (data.success) {
                    await loadSites();
                    loadSitesList();
                    document.getElementById('newSiteId').value = '';
                    document.getElementById('newSiteName').value = '';
                    document.getElementById('newSiteUrl').value = '';
                    alert('ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚');
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
                }
            } catch (error) {
                alert('ã‚µã‚¤ãƒˆè¿½åŠ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        async function toggleSite(siteId) {
            try {
                const site = allSites.find(s => s.id === siteId);
                const response = await fetch(`/sites/${siteId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !site.enabled })
                });

                const data = await response.json();
                if (data.success) {
                    await loadSites();
                    loadSitesList();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
                }
            } catch (error) {
                alert('ã‚µã‚¤ãƒˆæ›´æ–°ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        async function deleteSite(siteId) {
            if (!confirm(`ã‚µã‚¤ãƒˆ ${siteId} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;
            }

            try {
                const response = await fetch(`/sites/${siteId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    await loadSites();
                    loadSitesList();
                    alert('ã‚µã‚¤ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
                }
            } catch (error) {
                alert('ã‚µã‚¤ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        async function refreshSites() {
            await loadSites();
            alert('ã‚µã‚¤ãƒˆä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
        }

        async function loadConfigFile() {
            const fileInput = document.getElementById('configFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!file.name.endsWith('.json')) {
                alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            try {
                const text = await file.text();
                const sites = JSON.parse(text);
                
                if (!Array.isArray(sites)) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚µã‚¤ãƒˆã®é…åˆ—ãŒå¿…è¦ã§ã™ã€‚');
                    return;
                }
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
                const response = await fetch('/upload-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sites })
                });
                
                const data = await response.json();
                if (data.success) {
                    await loadSites();
                    alert(`${data.count}ã‚µã‚¤ãƒˆã®è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã™ã‚‹ã¨æ°¸ç¶šåŒ–ã•ã‚Œã¾ã™ã€‚`);
                    fileInput.value = '';
                } else {
                    alert('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.error);
                }
                
            } catch (error) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        async function compareImages(siteId, device) {
            showLoading(true);
            try {
                const response = await fetch('/compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ siteId, device, threshold: 2.0 })
                });
                
                const data = await response.json();
                if (data.success && data.result) {
                    displayComparisonResult(data.result, siteId, device);
                } else {
                    displayError('æ¯”è¼ƒå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                displayError('æ¯”è¼ƒå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayComparisonResult(result, siteId, device) {
            const isNG = result.status === 'NG';
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result ${isNG ? 'warning' : 'success'}">
                        <h3>ğŸ” ç”»åƒæ¯”è¼ƒçµæœ</h3>
                        <p><strong>ã‚µã‚¤ãƒˆ:</strong> ${siteId}</p>
                        <p><strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> ${device}</p>
                        <p><strong>åˆ¤å®š:</strong> ${isNG ? 'âš ï¸ NGï¼ˆå·®åˆ†æ¤œå‡ºï¼‰' : 'âœ… OKï¼ˆå·®åˆ†ãªã—ï¼‰'}</p>
                    </div>
                    
                    <div class="diff-info">
                        <div class="diff-stats">
                            <div class="diff-stat">
                                <div class="value" style="color: ${isNG ? '#dc3545' : '#28a745'}">${result.status}</div>
                                <div class="label">åˆ¤å®š</div>
                            </div>
                            <div class="diff-stat">
                                <div class="value">${result.diffPercentage}%</div>
                                <div class="label">å·®åˆ†ç‡</div>
                            </div>
                            <div class="diff-stat">
                                <div class="value">${result.diffPixels}</div>
                                <div class="label">å·®åˆ†ãƒ”ã‚¯ã‚»ãƒ«</div>
                            </div>
                        </div>
                        
                        ${result.diffPath ? `
                            <div style="margin-top: 20px;">
                                <h4>å·®åˆ†ç”»åƒ:</h4>
                                <a href="${result.diffPath}" target="_blank">
                                    <img src="${result.diffPath}" alt="å·®åˆ†ç”»åƒ" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px; margin-top: 10px;">
                                </a>
                                <p style="margin-top: 10px; color: #666; font-size: 0.9em;">ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§è¡¨ç¤º</p>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 20px;">
                            <button class="button secondary" onclick="showResults()">ğŸ”™ çµæœä¸€è¦§ã«æˆ»ã‚‹</button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function viewLatestSession(siteId, device) {
            showLoading(true);
            try {
                const response = await fetch(`/session-images/${siteId}/${device}`);
                const data = await response.json();
                
                if (data.success && data.images) {
                    displaySessionImages(data.images, siteId, device);
                } else {
                    displayError('ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»åƒã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                displayError('ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»åƒã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displaySessionImages(images, siteId, device) {
            const { baseline, after, comparisons } = images;
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result success">
                        <h3>ğŸ“¸ æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»åƒä¸€è¦§</h3>
                        <p><strong>ã‚µã‚¤ãƒˆ:</strong> ${siteId}</p>
                        <p><strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> ${device}</p>
                        <p><strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³æ—¥æ™‚:</strong> ${baseline.sessionTimestamp ? 
                            new Date(baseline.sessionTimestamp.replace(/-/g, ':')).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' }) : 
                            'ä¸æ˜'}</p>
                        <p><strong>ãƒšãƒ¼ã‚¸æ•°:</strong> ${baseline.files.length}ãƒšãƒ¼ã‚¸</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        ${baseline.files.map((baselineFile, index) => {
                            const afterFile = after.files[index];
                            const comparison = comparisons[index];
                            const pageNumber = index + 1;
                            
                            return `
                                <div class="diff-info" style="margin-bottom: 30px;">
                                    <h4>ğŸ“„ ãƒšãƒ¼ã‚¸ ${pageNumber}: ${baselineFile.pageIdentifier || 'ä¸æ˜'}</h4>
                                    
                                    ${comparison ? `
                                        <div style="margin: 15px 0; padding: 15px; background: ${comparison.status === 'NG' ? '#ffe6e6' : '#e6ffe6'}; border-radius: 6px;">
                                            <strong>æ¯”è¼ƒçµæœ:</strong> ${comparison.status} (å·®åˆ†ç‡: ${comparison.diffPercentage}%)
                                            ${comparison.diffPath ? `
                                                <a href="${comparison.diffPath}" target="_blank" style="margin-left: 15px;">ğŸ” å·®åˆ†ç”»åƒã‚’è¦‹ã‚‹</a>
                                            ` : ''}
                                        </div>
                                    ` : ''}
                                    
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 15px;">
                                        <div style="text-align: center;">
                                            <h5>ğŸŸ¢ æ›´æ–°å‰ (Baseline)</h5>
                                            <a href="${baselineFile.path}" target="_blank">
                                                <img src="${baselineFile.path}" alt="æ›´æ–°å‰" style="width: 100%; max-width: 500px; border: 2px solid #28a745; border-radius: 8px;">
                                            </a>
                                            <p style="margin-top: 5px; font-size: 0.9em; color: #666;">${baselineFile.filename}</p>
                                        </div>
                                        
                                        ${afterFile ? `
                                            <div style="text-align: center;">
                                                <h5>ğŸ”µ æ›´æ–°å¾Œ (After)</h5>
                                                <a href="${afterFile.path}" target="_blank">
                                                    <img src="${afterFile.path}" alt="æ›´æ–°å¾Œ" style="width: 100%; max-width: 500px; border: 2px solid #007bff; border-radius: 8px;">
                                                </a>
                                                <p style="margin-top: 5px; font-size: 0.9em; color: #666;">${afterFile.filename}</p>
                                            </div>
                                        ` : ''}
                                        
                                        ${comparison && comparison.diffPath ? `
                                            <div style="text-align: center;">
                                                <h5>ğŸ”´ å·®åˆ†ç”»åƒ</h5>
                                                <a href="${comparison.diffPath}" target="_blank">
                                                    <img src="${comparison.diffPath}" alt="å·®åˆ†" style="width: 100%; max-width: 500px; border: 2px solid #dc3545; border-radius: 8px;">
                                                </a>
                                                <p style="margin-top: 5px; font-size: 0.9em; color: #666;">å·®åˆ†: ${comparison.diffPercentage}%</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="button secondary" onclick="showResults()">ğŸ”™ çµæœä¸€è¦§ã«æˆ»ã‚‹</button>
                    </div>
                </div>
            `;
        }

        async function showResults() {
            try {
                const response = await fetch('/results');
                const data = await response.json();
                
                if (data.success && data.results.length > 0) {
                    displayAllResults(data.results);
                } else {
                    displayInfo('ğŸ“Š ä¿å­˜ã•ã‚ŒãŸçµæœã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
                }
            } catch (error) {
                displayError('çµæœã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        function displayAllResults(results) {
            const totalSites = results.length;
            
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result success">
                        <h3>ğŸ“Š ä¿å­˜ã•ã‚ŒãŸå®Ÿè¡Œçµæœ</h3>
                        <p><strong>å¯¾è±¡ã‚µã‚¤ãƒˆ:</strong> ${totalSites}ã‚µã‚¤ãƒˆ</p>
                    </div>
                    
                    ${results.map(site => `
                        <div class="diff-info">
                            <h4>ğŸŒ ${site.siteName}</h4>
                            <p><strong>URL:</strong> ${site.baseUrl}</p>
                            
                            ${site.devices.map(device => `
                                <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                                    <h5>ğŸ“± ${device.device}</h5>
                                    
                                    ${device.baseline.latest ? `
                                        <div style="margin: 10px 0;">
                                            <strong>ğŸŸ¢ Baseline (æ›´æ–°å‰):</strong>
                                            <ul style="margin: 5px 0; padding-left: 20px;">
                                                <li>æœ€æ–°: ${new Date(device.baseline.latest.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</li>
                                                <li>ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°: ${device.baseline.count}æš</li>
                                                ${device.baseline.sessions && device.baseline.sessions.length > 0 ? `
                                                    <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: ${device.baseline.sessions.length}å›
                                                        <details style="margin-top: 5px;">
                                                            <summary style="cursor: pointer; color: #667eea;">ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã‚’è¡¨ç¤º</summary>
                                                            <ul style="margin-top: 5px; font-size: 0.9em;">
                                                                ${device.baseline.sessions.slice(0, 5).map(session => `
                                                                    <li>${new Date(session.sessionTimestamp.replace(/-/g, ':')).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })} - ${session.fileCount}æš</li>
                                                                `).join('')}
                                                                ${device.baseline.sessions.length > 5 ? '<li>...</li>' : ''}
                                                            </ul>
                                                        </details>
                                                    </li>
                                                ` : ''}
                                                <li><a href="${device.baseline.latest.path}" target="_blank" style="color: #667eea;">ğŸ“¸ æœ€æ–°ç”»åƒã‚’è¡¨ç¤º</a></li>
                                            </ul>
                                        </div>
                                    ` : '<p style="color: #666;">âšª Baselineæœªæ’®å½±</p>'}
                                    
                                    ${device.after.latest ? `
                                        <div style="margin: 10px 0;">
                                            <strong>ğŸ”µ After (æ›´æ–°å¾Œ):</strong>
                                            <ul style="margin: 5px 0; padding-left: 20px;">
                                                <li>æœ€æ–°: ${new Date(device.after.latest.timestamp).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}</li>
                                                <li>ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°: ${device.after.count}æš</li>
                                                ${device.after.sessions && device.after.sessions.length > 0 ? `
                                                    <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: ${device.after.sessions.length}å›
                                                        <details style="margin-top: 5px;">
                                                            <summary style="cursor: pointer; color: #667eea;">ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ã‚’è¡¨ç¤º</summary>
                                                            <ul style="margin-top: 5px; font-size: 0.9em;">
                                                                ${device.after.sessions.slice(0, 5).map(session => `
                                                                    <li>${new Date(session.sessionTimestamp.replace(/-/g, ':')).toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })} - ${session.fileCount}æš</li>
                                                                `).join('')}
                                                                ${device.after.sessions.length > 5 ? '<li>...</li>' : ''}
                                                            </ul>
                                                        </details>
                                                    </li>
                                                ` : ''}
                                                <li><a href="${device.after.latest.path}" target="_blank" style="color: #667eea;">ğŸ“¸ æœ€æ–°ç”»åƒã‚’è¡¨ç¤º</a></li>
                                            </ul>
                                        </div>
                                    ` : '<p style="color: #666;">âšª Afteræœªæ’®å½±</p>'}
                                    
                                    ${device.hasBaseline && device.hasAfter ? `
                                        <p style="margin-top: 10px; color: #28a745;">âœ… æ¯”è¼ƒå¯èƒ½</p>
                                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                                            <button class="button secondary" onclick="compareImages('${site.siteId}', '${device.device}')" style="flex: 1;">
                                                ğŸ” ç”»åƒã‚’æ¯”è¼ƒ
                                            </button>
                                            <button class="button secondary" onclick="viewLatestSession('${site.siteId}', '${device.device}')" style="flex: 1;">
                                                ğŸ“¸ æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³è¡¨ç¤º
                                            </button>
                                        </div>
                                    ` : `
                                        <p style="margin-top: 10px; color: #dc3545;">âŒ æ¯”è¼ƒä¸å¯ï¼ˆä¸¡æ–¹ã®æ’®å½±ãŒå¿…è¦ï¼‰</p>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // åˆæœŸå€¤è¨­å®š
        updateExecuteButtonText();

        // æ—¢å­˜ã®æ—§é–¢æ•°ä¿æŒï¼ˆä¸‹ä½äº’æ›æ€§ï¼‰
        async function takeBeforeUpdate() {
            displayInfo('âš™ï¸ æ—§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–¢æ•°ã§ã™ã€‚æ–°ã—ã„UIã§Step2+3ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
        }
        
        async function takeAfterUpdate() {
            displayInfo('âš™ï¸ æ—§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–¢æ•°ã§ã™ã€‚æ–°ã—ã„UIã§Step2+3ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
        }
        
        async function compareUpdates() {
            displayInfo('âš™ï¸ æ—§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–¢æ•°ã§ã™ã€‚æ–°ã—ã„UIã§Step2+3ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
        }

        function displayFullVRTResults(data) {
            // æ—§é–¢æ•°ä¿æŒ
            displayInfo('æ—§çµæœè¡¨ç¤ºé–¢æ•°ã§ã™ã€‚');
        }

        function displayComparisonResults(results) {
            // æ—§é–¢æ•°ä¿æŒ
            displayInfo('æ—§çµæœè¡¨ç¤ºé–¢æ•°ã§ã™ã€‚');
        }

        function displayScreenshotResults(results, action) {
            // æ—§é–¢æ•°ä¿æŒ
            displayInfo('æ—§çµæœè¡¨ç¤ºé–¢æ•°ã§ã™ã€‚');
        }

        function displayError(error) {
            document.getElementById('results').innerHTML = `
                <div class="card">
                    <div class="result error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                        <p>${error}</p>
                    </div>
                </div>
            `;
        }

        async function loadScreenshots() {
            displayInfo('æ—§é–¢æ•°ã§ã™ã€‚ã‚µã‚¤ãƒˆç®¡ç†ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        }

        async function loadDiffs() {
            displayInfo('æ—§é–¢æ•°ã§ã™ã€‚ã‚µã‚¤ãƒˆç®¡ç†ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        }
    </script>
</body>
</html>