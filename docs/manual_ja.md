# WordPress Visual Diff Checker 操作マニュアル

## 目次

1. [はじめに](#はじめに)
2. [初期設定](#初期設定)
3. [基本的な使い方](#基本的な使い方)
4. [詳細な機能説明](#詳細な機能説明)
5. [トラブルシューティング](#トラブルシューティング)
6. [FAQ](#faq)

## はじめに

WordPress Visual Diff Checker は、WordPress サイトのプラグインやテーマ更新による画面の変化を自動的に検出するツールです。このマニュアルでは、日常的な操作方法について説明します。

### システムの概要

```
[管理画面] → [実行ボタン] → [自動スクリーンショット] → [差分検出] → [レポート出力]
```

## 初期設定

### ステップ 1: Google アカウントでログイン

1. 提供された管理画面 URL にアクセス
2. Google アカウントでログイン
3. 必要な権限を承認

### ステップ 2: 通知設定（オプション）

#### Slack 通知を有効にする場合

1. Slack ワークスペースで Incoming Webhook を作成
2. Webhook URL をコピー
3. 管理画面の「設定」→「通知設定」に貼り付け

#### Discord 通知を有効にする場合

1. Discord サーバーで Webhook を作成
2. Webhook URL をコピー
3. 管理画面の「設定」→「通知設定」に貼り付け

## 基本的な使い方

### サイトの登録

#### 新規サイトを追加する

1. 管理画面の「サイト管理」タブを開く
2. 「新規サイト追加」セクションで以下を入力：
   - **サイト名**: 管理しやすい名前（例：コーポレートサイト）
   - **URL**: WordPress サイトのトップページ URL
3. 「追加」ボタンをクリック

![サイト追加画面](images/add-site.png)

#### 登録済みサイトの確認

- 「登録サイト一覧」に追加したサイトが表示されます
- 各サイトの情報：
  - **サイト名**: 登録時に設定した名前
  - **URL**: 対象サイトの URL
  - **最終実行**: 最後にチェックを実行した日時
  - **ステータス**: 
    - `待機中`: 未実行
    - `実行中`: 処理中
    - `完了`: 正常終了
    - `エラー`: 異常終了

### 差分チェックの実行

#### 手動実行

1. チェックしたいサイトの行にある「実行」ボタンをクリック
2. 確認ダイアログで「OK」をクリック
3. 処理が開始され、ステータスが「実行中」に変わります

![実行ボタン](images/run-button.png)

#### 実行の流れ

1. **Baseline 撮影**（5-10分）
   - 更新前の全ページをスクリーンショット
   - 最大 300 ページまで自動クロール

2. **After 撮影**（5-10分）
   - プラグイン/テーマ更新後に再度スクリーンショット
   - Baseline と同じページを撮影

3. **差分比較**（1-2分）
   - ピクセル単位で画像を比較
   - 2% 以上の差分を「NG」として検出

4. **レポート生成**（即時）
   - Google Sheets に結果を記録
   - NG がある場合は通知を送信

### 結果の確認

#### Google Sheets での確認

1. 管理画面の「レポート表示」ボタンをクリック
2. Google Sheets が開きます
3. サイトごとのタブで結果を確認

![Sheets レポート](images/sheets-report.png)

各列の説明：
- **Date**: チェック実行日
- **URL**: ページの URL
- **Baseline**: 更新前の画像パス
- **After**: 更新後の画像パス
- **Diff**: 差分画像パス
- **Diff%**: 差分の割合
- **Status**: OK（問題なし）/ NG（差分あり）

#### 画像の確認方法

1. Sheets の画像パスをクリック
2. Google Drive で画像が開きます
3. 差分画像では変更箇所が赤色で表示されます

![差分画像の例](images/diff-example.png)

#### 通知の確認

NG が検出された場合、以下の形式で通知されます：

```
🚨 コーポレートサイト で 3 件の差分が検出されました
- https://example.com/about (5.23%)
- https://example.com/contact (3.15%)
- https://example.com/products (2.87%)
```

## 詳細な機能説明

### サイト管理機能

#### サイトの編集

1. サイト一覧で編集したいサイトの「編集」アイコンをクリック
2. サイト名や URL を変更
3. 「保存」をクリック

#### サイトの削除

1. サイト一覧で削除したいサイトの「削除」アイコンをクリック
2. 確認ダイアログで「OK」をクリック
3. 関連するデータも削除されます

### 実行オプション

#### 部分実行

特定のモードのみ実行することも可能です：

- **Baseline のみ**: 更新前の状態だけ記録
- **After のみ**: 更新後の状態だけ記録（要 Baseline）
- **比較のみ**: 既存のデータで再比較

### データ管理

#### エクスポート

1. Sheets の「ファイル」→「ダウンロード」
2. 希望の形式を選択（Excel、CSV など）

#### 古いデータの確認

- 90日間は全てのデータが保持されます
- それ以前のデータは自動的に削除されます

## トラブルシューティング

### よくある問題と解決方法

#### 「実行」ボタンが反応しない

**原因**: ブラウザのポップアップブロック
**解決方法**: 
1. ブラウザの設定でポップアップを許可
2. ページを再読み込み

#### ステータスが「実行中」のまま変わらない

**原因**: 処理に時間がかかっている、またはエラー
**解決方法**:
1. 30分待つ
2. それでも変わらない場合は、ページを再読み込み
3. エラーログを確認

#### スクリーンショットが真っ白

**原因**: ページの読み込みが完了する前に撮影
**解決方法**: 管理者に連絡して待機時間を調整

#### 差分が過剰に検出される

**原因**: 動的コンテンツ（広告、日付など）
**解決方法**: 
1. 該当ページを除外リストに追加
2. 差分閾値を調整（管理者に依頼）

### エラーメッセージ一覧

| エラーメッセージ | 意味 | 対処法 |
|----------------|------|--------|
| `サイトが見つかりません` | サイト情報が削除された | サイトを再登録 |
| `Baseline が存在しません` | 更新前の画像がない | Baseline を先に実行 |
| `タイムアウトしました` | 処理時間超過 | ページ数を減らすか再実行 |
| `権限がありません` | アクセス権限不足 | 管理者に連絡 |

## FAQ

### Q: 一度に複数のサイトをチェックできますか？

A: 現在は1サイトずつの実行となります。複数サイトを順番に実行することは可能です。

### Q: チェックにかかる時間はどのくらいですか？

A: サイトの規模により異なりますが、目安は以下の通りです：
- 小規模（〜50ページ）: 10-15分
- 中規模（50-150ページ）: 15-30分
- 大規模（150-300ページ）: 30-45分

### Q: 特定のページを除外できますか？

A: はい、管理画面の「除外設定」から特定の URL パターンを登録できます。

### Q: 過去の結果を比較できますか？

A: Google Sheets で過去の実行結果を確認し、手動で比較することが可能です。

### Q: モバイル表示のチェックはできますか？

A: 現在はデスクトップ表示（1920×1080）のみ対応しています。

### Q: パスワード保護されたページはチェックできますか？

A: Basic 認証には対応していますが、事前に設定が必要です。管理者にご相談ください。

### Q: 差分の判定基準を変更できますか？

A: デフォルトは 2% ですが、サイトごとに調整可能です。管理者に依頼してください。

## お問い合わせ

操作で不明な点がございましたら、以下までご連絡ください：

- **メール**: support@example.com
- **Slack**: #vrt-support チャンネル
- **GitHub Issues**: [こちら](https://github.com/YOUR_USERNAME/wordpress-visual-diff-checker/issues)

---

最終更新日: 2024年1月8日